# RustFuzz 快速参考

## 🚀 快速开始

```bash
# 1. 安装
git clone <repository>
cd RustFuzz
pip install -r requirements.txt

# 2. 配置 (编辑 config.toml 和 libraries.toml)
python RustFuzz.py configure --init

# 3. 运行
python RustFuzz.py preprocess -L <library>
python RustFuzz.py generate -L <library> --count 10
python RustFuzz.py fuzz -L <library>
```

## 📋 常用命令

### 配置
```bash
python RustFuzz.py configure --init     # 初始化配置
```

### 预处理
```bash
python RustFuzz.py preprocess -L lib    # 分析代码
python RustFuzz.py preprocess -L lib --force  # 强制重新分析
```

### 生成
```bash
python RustFuzz.py generate -L lib --count 10              # 生成 10 个
python RustFuzz.py generate -L lib --task allcover         # 覆盖所有 API
python RustFuzz.py generate -L lib --functions "a,b,c"     # 指定函数
```

### Fuzzing
```bash
python RustFuzz.py fuzz -L lib                    # 运行所有
python RustFuzz.py fuzz -L lib --target target_1  # 运行特定 target
python RustFuzz.py fuzz -L lib --timeout 3600     # 1小时
python RustFuzz.py fuzz -L lib --jobs 4           # 4个并行任务
```

### 分析
```bash
python RustFuzz.py analyze -L lib         # 分析 crash
python RustFuzz.py stats -L lib           # 显示统计
python RustFuzz.py stats -L lib --coverage  # 覆盖率
```

## ⚙️ 配置文件模板

### config.toml
```toml
[llm]
openai_api_key = "your-key"
openai_model = "gpt-4"

[preprocessor]
extract_test_cases = true
analyze_unsafe_blocks = true

[generator]
function_set_size = 3
max_rounds = 50
prioritize_unsafe = true

[fuzzer]
engine = "libfuzzer"
timeout = 3600
sanitizers = ["address"]
```

### libraries.toml
```toml
[your_crate]
language = "rust"
crate_path = "/path/to/crate"
source_paths = ["src"]
output_path = "output/your_crate"
features = []
api_hints = []
```

## 🔧 环境要求

- Python 3.10+
- Rust (nightly)
- cargo-fuzz
- LLVM/Clang

## 📁 输出目录结构

```
output/your_crate/
├── ast.json              # AST 分析结果
├── fuzz_targets/         # 生成的 fuzz target
│   ├── fuzz_target_1.rs
│   └── fuzz_target_2.rs
├── fuzz_project/         # cargo-fuzz 项目
│   └── fuzz/
│       ├── fuzz_targets/
│       ├── corpus/
│       └── artifacts/
└── crash_report.json     # Crash 分析报告
```

## 💡 常见任务

### 测试特定函数
```bash
python RustFuzz.py generate -L lib --task given --functions "parse,process"
```

### 长时间 fuzzing
```bash
python RustFuzz.py fuzz -L lib --timeout 86400  # 24小时
```

### 使用本地 LLM
```toml
# config.toml
[llm]
use_ollama = true
ollama_model = "codellama:13b"
```

### 手动编辑 fuzz target
```bash
# 生成后编辑
vim output/lib/fuzz_targets/fuzz_target_1.rs
# 然后运行
python RustFuzz.py fuzz -L lib --target fuzz_target_1
```

## 🐛 调试技巧

### 查看详细日志
```bash
python RustFuzz.py -D preprocess -L lib  # -D 启用 debug
```

### 复现 crash
```bash
cd output/lib/fuzz_project
cargo fuzz run target_1 artifacts/crash-xxx
```

### 最小化 crash 输入
```bash
cargo fuzz cmin target_1  # 最小化 corpus
cargo fuzz tmin target_1 artifacts/crash-xxx  # 最小化单个输入
```

## 📊 结果解读

### ast.json
包含代码结构分析结果：
- functions: 函数列表
- structs: 结构体
- enums: 枚举
- traits: Trait 定义
- unsafe_blocks: Unsafe 代码位置

### crash_report.json
包含 crash 信息：
- file: crash 文件名
- path: 完整路径
- size: 输入大小

## 🎯 最佳实践

1. **从简单开始**: 先测试简单函数
2. **逐步增加**: 逐步提高复杂度
3. **重点关注**: 优先测试 unsafe 和解析函数
4. **持续运行**: 长时间 fuzzing 效果更好
5. **定期分析**: 及时查看结果

## 🔗 更多资源

- **详细教程**: TUTORIAL.md
- **技术设计**: DESIGN.md
- **项目总结**: PROJECT_SUMMARY.md
- **简单示例**: examples/SIMPLE_EXAMPLE.md

## 💬 常见问题速查

| 问题 | 解决方案 |
|------|---------|
| 编译失败 | 检查 Cargo.toml 依赖 |
| LLM 超时 | 降低 function_set_size |
| 没发现 crash | 增加运行时间或提供种子 |
| 覆盖率低 | 生成更多 fuzz target |
| 内存不足 | 减少并行任务数 |

## 📞 获取帮助

```bash
python RustFuzz.py --help              # 总体帮助
python RustFuzz.py <command> --help    # 命令帮助
```

---

**提示**: 保存此文件以便快速查阅常用命令和配置！
